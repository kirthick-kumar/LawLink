{% extends 'header.html' %}
{% block content %}
<!--Search-->
  <div class="px-4 pt-5 mt-5 text-center">
    <h1 class="display-4 fw-bold text-body-emphasis">Search For Lawyers</h1>
    <div class="col-lg-7 mx-auto">
      <p class="lead mb-4">Quickly customize responsive mobile-first sites with Bootstrap, the worldâ€™s most popular front-end open source toolkit, featuring Sass variables and mixins, responsive grid system, extensive prebuilt components, and powerful JavaScript plugins.</p>
      <form id="searchForm" enctype="multipart/form-data" class="mx-1 mx-md-4 pb-3" data-sb-form-api-token="API_TOKEN" action="{{ url_for('search') }}" method="post">
        <div class="dropdown">
          <button id="case" class="btn btn-brown dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" value="">Case Type</button>
          <input id="icase" hidden="hidden" value="" name="case">
          <ul class="dropdown-menu">
            <li><button type="button" class="dropdown-item btn btn-light" onclick="change('case', 'Criminal', 'Case Type: Criminal')">Criminal</button></li>
            <li><button type="button" class="dropdown-item btn btn-light" onclick="change('case', 'Family', 'Case Type: Family')">Family</button></li>
            <li><button type="button" class="dropdown-item btn btn-light" onclick="change('case', 'Property', 'Case Type: Property')">Property</button></li>
            <li><button type="button" class="dropdown-item btn btn-light" onclick="change('case', 'Intellectual Property', 'Case Type: Intellectual Property')">Intellectual Property</button></li>
            <li><button type="button" class="dropdown-item btn btn-light" onclick="change('case', 'Employment', 'Case Type: Employment')">Employment</button></li>
            <li><button type="button" class="dropdown-item btn btn-light" onclick="change('case', 'Entertainment', 'Case Type: Entertainment')">Entertainment</button></li>
            <li><button type="button" class="dropdown-item btn btn-light" onclick="change('case', 'Malpractice', 'Case Type: Malpractice')">Malpractice</button></li>
            <li><button type="button" class="dropdown-item btn btn-light" onclick="change('case', 'Constitutional', 'Case Type: Constitutional')">Constitutional</button></li>
            <li><button type="button" class="dropdown-item btn btn-light" onclick="change('case', 'Business', 'Case Type: Business')">Business</button></li>
            <li><button type="button" class="dropdown-item btn btn-light" onclick="change('case', 'Civil', 'Case Type: Civil')">Civil</button></li>
            <li><button type="button" class="dropdown-item btn btn-light" onclick="change('case', '', 'Case Type')">None</button></li>
          </ul>

          <button id="rating" class="btn btn-brown dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" value="">Avg Rating</button>
          <input id="irating" hidden="hidden" value="" name="rating">
          <ul class="dropdown-menu">
            <li><button type="button" class="dropdown-item btn btn-light" onclick="change('rating', '5', 'Rating: ðŸŒ•ðŸŒ•ðŸŒ•ðŸŒ•ðŸŒ•')">ðŸŒ•ðŸŒ•ðŸŒ•ðŸŒ•ðŸŒ•</button></li>
            <li><button type="button" class="dropdown-item btn btn-light" onclick="change('rating', '4', 'Rating: ðŸŒ•ðŸŒ•ðŸŒ•ðŸŒ•ðŸŒ‘')">ðŸŒ•ðŸŒ•ðŸŒ•ðŸŒ•ðŸŒ‘</button></li>
            <li><button type="button" class="dropdown-item btn btn-light" onclick="change('rating', '3', 'Rating: ðŸŒ•ðŸŒ•ðŸŒ•ðŸŒ‘ðŸŒ‘')">ðŸŒ•ðŸŒ•ðŸŒ•ðŸŒ‘ðŸŒ‘</button></li>
            <li><button type="button" class="dropdown-item btn btn-light" onclick="change('rating', '2', 'Rating: ðŸŒ•ðŸŒ•ðŸŒ‘ðŸŒ‘ðŸŒ‘')">ðŸŒ•ðŸŒ•ðŸŒ‘ðŸŒ‘ðŸŒ‘</button></li>
            <li><button type="button" class="dropdown-item btn btn-light" onclick="change('rating', '1', 'Rating: ðŸŒ•ðŸŒ‘ðŸŒ‘ðŸŒ‘ðŸŒ‘')">ðŸŒ•ðŸŒ‘ðŸŒ‘ðŸŒ‘ðŸŒ‘</button></li>
            <li><button type="button" class="dropdown-item btn btn-light" onclick="change('rating', '', 'Avg Rating')">None</button></li>
          </ul>
          <button id="budget" class="btn btn-brown dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" value="">Budget</button>
          <input id="ibudget" hidden="hidden" value="" name="budget">
          <ul class="dropdown-menu px-1">
            <li class="mb-2 px-2">Per Consultation Fee</li>
            <li><input type="range" class="form-control form-range border shadow-sm" value="" min="0" max="10000" step="100" oninput="change('budget', this.value, 'Budget: â‚¹'+this.value)"></li>
            <li><button type="button" class="dropdown-item btn btn-light" onclick="change('budget', '', 'Budget')">None</button></li>
          </ul>

          <button id="experience" class="btn btn-brown dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" value="">Experience</button>
          <input id="iexperience" hidden="hidden" value="" name="experience">
          <ul class="dropdown-menu px-1">
            <li class="mb-2 px-2">Years of Experience</li>
            <li><input type="range" class="form-control form-range border shadow-sm" value="0" min="0" max="20" oninput="change('experience', this.value, 'Experience: '+this.value+' Years')"></li>
            <li><button type="button" class="dropdown-item btn btn-light" onclick="change('experience', '', 'Experience')">None</button></li>
          </ul>

          <button id="win_loss" class="btn btn-brown dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" value="">Winning Percentage</button>
          <input id="iwin_loss" hidden="hidden" value="" name="win">
          <ul class="dropdown-menu px-1">
            <li class="mb-2 px-2">Percentage of Cases Won</li>
            <li><input type="range" class="form-control form-range border shadow-sm" value="" min="0" max="100" oninput="change('win_loss', this.value, 'Winning Percentage: '+this.value+'%')"></li>
            <li><button type="button" class="dropdown-item btn btn-light" onclick="change('win_loss', '', 'Winning Percentage')">None</button></li>
          </ul>

          <button id="Location" class="btn btn-brown dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" value="">Location</button>
          <input id="iLocation" hidden="hidden" value="" name="location">
          <ul class="dropdown-menu">
            <li>
              <input class="form-control" autocomplete="off" list="datalistOptions" id="exampleDataList" placeholder="State in India" onchange="change('Location', this.value, this.value)">
              <datalist id="datalistOptions">
                <option value="Andhra Pradesh">
                <option value="Arunachal Pradesh">
                <option value="Assam">
                <option value="Bihar">
                <option value="Chhattisgarh">
                <option value="Goa">
                <option value="Gujarat">
                <option value="Haryana">
                <option value="Himachal Pradesh,">
                <option value="Jharkhand">
                <option value="Karnataka">
                <option value="Kerala">
                <option value="Madhya Pradesh">
                <option value="Maharashtra">
                <option value="Manipur">
                <option value="Meghalaya">
                <option value="Mizoram">
                <option value="Nagaland">
                <option value="Odisha">
                <option value="Punjab">
                <option value="Rajasthan">
                <option value="Sikkim">
                <option value="Tamil Nadu">
                <option value="Telangana">
                <option value="Tripura">
                <option value="Uttar Pradesh">
                <option value="Uttarakhand">
                <option value="West Bengal">
              </datalist>
            </li>
          </ul>
        </div>

        <div class="d-flex mt-3">
          <input type="text" id="name" class="form-control shadow-sm me-1" name="name" placeholder="Name" autocomplete="off">
          <input type="text" id="bar_council_id" class="form-control shadow-sm me-1 w-50" name="bar_council_id" autocomplete="off" placeholder="Bar Council ID">
          <button type="submit" class="btn btn-brown pb-2">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-search" viewBox="0 0 16 16">
              <path d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001q.044.06.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1 1 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0"/>
            </svg>
          </button>
        </div>
      </form>
    </div>

<!--Results-->
    <div class="container mt-5 mb-5">
      <div class="d-flex justify-content-center row">
        <div class="col-md-8">
        {% for lawyer in matching_lawyers: %}
          <div class="row p-2 bg-white border-danger rounded-3 shadow mt-2 mb-5">
            <div class="col-3 my-3 rounded">
              <img class="rounded-circle shadow" src="{{ url_for('static', filename=lawyer.pic_url) }}" width="120px" height="120px">
              {% if lawyer.verified_count > 0: %}
                {% set avg_rating = (lawyer.verified_sum/lawyer.verified_count)|round(1) %}
                {% if avg_rating - avg_rating|int == 0.5: %}
                  {% set avg_rating = avg_rating|int + 0.5 %}
                {% elif avg_rating - avg_rating|int > 0.5: %}
                  {% set avg_rating = avg_rating|int + 0.7 %}
                {% elif avg_rating - avg_rating|int < 0.5 and avg_rating - avg_rating|int > 0.1: %}
                  {% set avg_rating = avg_rating|int + 0.2 %}
                {% else: %}
                  {% set avg_rating = avg_rating %}
                {% endif %}
                <div class="mt-3">
                  <span class="p-1 pe-2 rounded border shadow-sm">{{ rating_dict[avg_rating] }} {{ lawyer.verified_count }}</span>
                </div>
              {% else: %}
                <div class="mt-3">
                  <span class="p-1 px-2 rounded border shadow-sm">No Verified Reviews</span>
                </div>
              {% endif %}
            </div>
            <div class="col-md-6 mt-1 text-brown row border-start">
              <h3 class="mt-2 fw-bold row border-bottom mt-2">{{ lawyer.name }}</h3>
              <p class="d-flex mb-0 fw-bold">Location:&nbsp;&nbsp;<span class="text-dark pos-665">{{ lawyer.location }}</span></p>
              <p class="d-flex mb-0 fw-bold">Expertise:&nbsp;&nbsp;<span class="text-dark pos-665">{{ lawyer.expertise }}</span></p>
              <p class="d-flex mb-0 fw-bold">Experience:&nbsp;&nbsp;<span class="text-dark pos-665">{{ lawyer.experience }} Years</span></p>
              <p class="d-flex fw-bold">Win Percent:&nbsp;&nbsp;<span class="text-dark pos-665">{{ (lawyer.won/(lawyer.lost+lawyer.won)*100)|int }}%</span></p>
            </div>
            <div class="align-items-center align-content-center col border-start">
              <div class="d-flex flex-row align-items-center ms-1">
                <h4 class="me-2">â‚¹{{ lawyer.fee }}</h4><span>Per Consultation</span>
              </div>
              {% if lawyer.verified: %}
                <p class="text-success d-flex my-2 ms-2">Verified By LawLink</p>
              {% else: %}
                <p class="text-danger d-flex my-2 ms-2">Unverified Lawyer</p>
              {% endif %}
              <p class="text-brown d-flex my-2 ms-2">Bar Council ID: {{ lawyer.bar_council_id }}</p>
              <div class="d-flex flex-column mt-4">
                <a href="/profile/{{ lawyer.id }}" class="btn btn-brown ms-2" type="button">Details</a>
              </div>
            </div>
          </div>
        {% else %}
          <div class="overflow-hidden" style="max-height: 42vh;">
            <div class="container px-5">
              <h4 class="mb-3">No Lawyers Found</h4>
              <img src="static/images/no_search.png" class="img-fluid" alt="Example image" width="700" height="500" loading="lazy">
            </div>
          </div>
        {% endfor %}
        </div>
      </div>
    </div>
  </div>
{% include 'footer.html' %}
{% endblock %}